<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Contractor Bill</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; font-size: 10pt; }
        h1, h2, h3 { text-align: center; margin: 5px 0; }
        table { border-collapse: collapse; width: 198.5mm; margin: 10px auto; }
        th, td { border: 1px solid black; padding: 3px; text-align: left; vertical-align: top; }
        th { font-weight: bold; text-align: center; }
        .header-info { text-align: left; margin: 10px auto; width: 198.5mm; }
        .summary-table { border: none; width: auto; margin: 10px auto; }
        .summary-table td { border: none; padding: 3px; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>

<h1>CONTRACTOR BILL</h1>

<div class="header-info">
{% if data.header %}
    <pre>
{% for row in data.header %}
    {% if row|length > 0 %}
        {% for item in row %}
            {% if item|trim %}
                {% set trimmed = item|trim %}
                {% if trimmed|length >= 10 and trimmed[4:5] == '-' and trimmed[7:8] == '-' and trimmed[:4]|int > 0 and trimmed[5:7]|int > 0 and trimmed[8:10]|int > 0 %}
                    {{ trimmed[8:10] }}/{{ trimmed[5:7] }}/{{ trimmed[:4] }}
                {% else %}
                    {{ trimmed }}
                {% endif %}
            {% endif %}
        {% endfor %}
    {% endif %}
{% endfor %}
    </pre>
{% else %}
    <p>Name of Contractor or supplier: {{ data.name_of_firm }}</p>
    <p>Name of Work: {{ data.name_of_work }}</p>
    <p>Serial No. of this bill: {{ data.bill_no }}</p>
    <p>No. and date of the last bill: {{ data.last_bill }}</p>
    <p>Reference to work order or Agreement: {{ data.reference }}</p>
    <p>Agreement No: {{ data.agreement_no }}</p>
    <p>Date of written order to commence work: {{ data.date_commencement }}</p>
    <p>St. date of Start: {{ data.date_start }}</p>
    <p>St. date of completion: {{ data.date_completion }}</p>
    <p>Date of actual completion of work: {{ data.actual_completion }}</p>
    <p>Date of measurement: {{ data.measurement_date }}</p>
    <p>WORK ORDER AMOUNT RS. {{ data.work_order_amount }}</p>
{% endif %}
</div>

<h2>FOR CONTRACTORS & SUPPLIERS ONLY FOR PAYMENT FOR WORK OR SUPPLIES ACTUALLY MEASURED</h2>
<h3>WORK ORDER</h3>
<p>Cash Book Voucher No. Date-</p>

<table>
    <tr>
        <th width="11.7mm">Unit</th>
        <th width="16mm">Quantity executed (or supplied) since last certificate</th>
        <th width="16mm">Quantity executed (or supplied) upto date as per MB</th>
        <th width="11.1mm">Item No.</th>
        <th width="74.2mm">Item of Work supplies (Grouped under "sub-head" and "sub work" of estimate)</th>
        <th width="15.3mm">Rate</th>
        <th width="22.7mm">Amount upto date</th>
        <th width="17.6mm">Amount Since previous bill (Total for each sub-head)</th>
        <th width="13.9mm">Remark</th>
    </tr>
    {% for item in data.bill_items %}
    <tr>
        <td>{{ item.unit or '' }}</td>
        <td>{{ "%.2f" | format(item.quantity_since) if item.quantity_since is defined else '' }}</td>
        <td>{{ "%.2f" | format(item.quantity_upto) if item.quantity_upto is defined else '' }}</td>
        <td>{{ item.serial_no or '' }}</td>
        <td>{{ item.description or '' }}</td>
        <td>{{ "%.2f" | format(item.rate) if item.rate is defined else '' }}</td>
        <td>{{ "%.2f" | format(item.amount_upto) if item.amount_upto is defined else '' }}</td>
        <td>{{ "%.2f" | format(item.amount_since) if item.amount_since is defined else '' }}</td>
        <td>{{ item.remark or '' }}</td>
    </tr>
    {% endfor %}
    {% if data.extra_items %}
    <tr>
        <td colspan="9">Extra Items</td>
    </tr>
    {% for item in data.extra_items %}
    <tr>
        <td>{{ item.unit or '' }}</td>
        <td>{{ "%.2f" | format(item.quantity_since) if item.quantity_since is defined else '' }}</td>
        <td>{{ "%.2f" | format(item.quantity_upto) if item.quantity_upto is defined else '' }}</td>
        <td>{{ item.serial_no or '' }}</td>
        <td>{{ item.description or '' }}</td>
        <td>{{ "%.2f" | format(item.rate) if item.rate is defined else '' }}</td>
        <td>{{ "%.2f" | format(item.amount_upto) if item.amount_upto is defined else '' }}</td>
        <td>{{ "%.2f" | format(item.amount_since) if item.amount_since is defined else '' }}</td>
        <td>{{ item.remark or '' }}</td>
    </tr>
    {% endfor %}
    <tr>
        <td colspan="5">Extra Items Total Rs.</td>
        <td colspan="4">{{ "%.2f" | format(data.extra_items_base) if data.extra_items_base > 0 else 'NIL' }}</td>
    </tr>
    <tr>
        <td colspan="5">Tender Premium @ {{ "%.2f%%" | format(data.tender_premium_percent * 100) }}</td>
        <td colspan="4">{{ "%.2f" | format(data.extra_premium) if data.extra_premium > 0 else 'NIL' }}</td>
    </tr>
    <tr>
        <td colspan="5">Extra Items Grand Total (including Tender Premium) Rs.</td>
        <td colspan="4">{{ "%.2f" | format(data.extra_items_sum) if data.extra_items_sum > 0 else 'NIL' }}</td>
    </tr>
    {% endif %}
</table>

<table class="summary-table">
    <tr>
        <td>Main Items Grand Total Rs.</td>
        <td>{{ "%.2f" | format(data.bill_total) }}</td>
    </tr>
    <tr>
        <td>Tender Premium @ {{ "%.2f%%" | format(data.tender_premium_percent * 100) }}</td>
        <td>{{ "%.2f" | format(data.bill_premium) }}</td>
    </tr>
    <tr>
        <td>Total Payable Amount Rs.</td>
        <td>{{ "%.2f" | format(data.bill_grand_total + data.extra_items_sum) }}</td>
    </tr>
    {% if data.last_bill_amount %}
    <tr>
        <td>Less Amount Paid wide Last Bill</td>
        <td>{{ "%.2f" | format(data.last_bill_amount) }}</td>
    </tr>
    <tr>
        <td>Net Payable Amount</td>
        <td>{{ "%.2f" | format(data.net_payable) }}</td>
    </tr>
    {% endif %}
</table>

</body>
</html>
